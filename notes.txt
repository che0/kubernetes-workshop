https://www.radishlogic.com/kubernetes/running-minikube-in-aws-ec2-ubuntu/


===
GKE create VPC-native (aby se dal spojit s out-of-cluster MySQL)
    VPC-native
    private cluster
    needs external master ip
    master ip range can be default
private kube cluster needs cloud nat for the nodes to get out - create cloud nat
    bacha na regiony

    

service names
    For example, if you have a Service called "my-service" in a Kubernetes Namespace called "my-ns", a DNS record for "my-service.my-ns" is created.
    

kubectl apply -f
 deploy


Jak najit a pozabijet vsechny nebezici pody
    kubectl get pod --field-selector status.phase!=Running
    kubectl delete pod --field-selector status.phase!=Running

Zmena configmapy se nedotkne bezici pody. Reseni: verzovat (hashem) configmapy, v deploymentech se odkazovat na specifickou verzi, a pak preposlat deploymenty.


kubectl exec hello-678dc98cd7-q8gpk /bin/bash -ti

Ingressu (nebo asi cemukoliv na global external IP) muze trvat cca 10 minut nez se chyti (pokus 1: 8 minut 404, pak flapy cca minutu, pak uz stabilni 200)

Aplikace TLS do Ingressu:
    ~1051 nastaveno
    1100 http prechazi do 404, na tls jsou uz jine chyby
    1101 tls prechazi do 404
    1105 na http se zacina objevovat backend
    1106 backend uz je i na tls



===
Postup:
0. Tupa webovka + LoadBalancer pres command line
    kubectl run hello --image pn2d/hello-web:v1 --port=80 --replicas=1
    kubectl expose deploy hello --port 80 --target-port 80 --type=LoadBalancer --name=pub-hello
1. Deployment tupe webovky na HTTP + LoadBalanceru se statickou IP
2. Tupy backend + pripojeni pres ClusterIP a DNS alias + liveness + readiness
3. Mene tupy backend s mysql a persistent volume
4. Nastaveni v configmaps, hesla do MySQL v secrets
5. Normalni webova aplikace (pod s nginx + uwsgi)
6. Cron joby
7. Ingress
8. TLS
9. phpBB
